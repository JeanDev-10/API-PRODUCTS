# ğŸ“¦ API_Productos

API RESTful para la gestiÃ³n de productos utilizando .NET 8, Entity Framework Core, FluentValidation, y paginaciÃ³n con filtros dinÃ¡micos. Incluye manejo estructurado de respuestas con clases ApiResponse, validaciones robustas, y limitaciÃ³n de solicitudes (rate limiting).

## ğŸ“ Estructura del Proyecto

```bash
API_Productos/
â”œâ”€â”€ Controllers/              # Endpoints HTTP
â”œâ”€â”€ DTOs/                    # Data Transfer Objects
â”œâ”€â”€ â”œâ”€â”€Product/         # Respuestas estÃ¡ndar
â”‚       â”œâ”€â”€ ProductCreateDto.cs
â”‚       â”œâ”€â”€ ProductUpdateDto.cs
â”‚       â”œâ”€â”€ ProductResponseDto.cs
â”‚   â””â”€â”€ ApiResponse/         # Respuestas estÃ¡ndar
â”‚       â”œâ”€â”€ ApiResponse.cs
â”‚       â”œâ”€â”€ ApiResponseData.cs
â”‚       â””â”€â”€ PagedResponse.cs
â”œâ”€â”€ Models/                  # Entidad Product.cs
â”œâ”€â”€ Repositories/           # Interfaces y repositorio
â”œâ”€â”€ Services/               # LÃ³gica de negocio
â”œâ”€â”€ Validators/             # Validaciones con FluentValidation
â”œâ”€â”€ Interaces/             # interfaces
â”œâ”€â”€ Context/                   # DbContext
â”œâ”€â”€ appsettings.json        # ConfiguraciÃ³n
â”œâ”€â”€ Program.cs              # ConfiguraciÃ³n general y middleware
```

## ğŸš€ Endpoints

Todos los endpoints estÃ¡n bajo la ruta base:

```bash
/api/products
```

### âœ… GET /api/products

**DescripciÃ³n**: Obtener lista paginada de productos con filtros opcionales.

**Query params:**

| Nombre      | Tipo    | DescripciÃ³n                          |
| ----------- | ------- | ------------------------------------ |
| name        | string  | Filtrar por nombre                   |
| description | string  | Filtrar por descripciÃ³n              |
| price       | decimal | Filtrar por precio exacto            |
| stock       | int     | Filtrar por cantidad en stock exacta |
| page        | int     | PÃ¡gina actual (por defecto: 1)       |
| pageSize    | int     | PÃ¡gina actual (por defecto: 10)      |

## âœ… Validaciones con FluentValidation

Ubicadas en /Validators/, cada DTO se valida antes de llegar al servicio.

Reglas para ProductCreateDto y ProductUpdateDto:
|Campo |ValidaciÃ³n|
|-------|----------|
|name |No vacÃ­o, mÃ¡x. 100 caracteres|
|description |No vacÃ­o, mÃ¡x. 500 caracteres|
|price |>= 0|
|stock |>= 0|

Los errores se devuelven automÃ¡ticamente como respuestas 400 BadRequest con detalles de validaciÃ³n.

## ğŸ“š LibrerÃ­as Usadas

Paquete Uso Principal
| FluentValidation | ValidaciÃ³n de DTOs|
|-------------------|---------------------|
| EntityFrameworkCore | ORM para base de datos|
| EntityFrameworkCore.SqlServer | Proveedor de SQL Server|
| Swashbuckle.AspNetCore | Swagger UI y documentaciÃ³n automÃ¡tica|
| xUnit, Moq, FluentAssertions (tests) | Testing unitario e integraciÃ³n|

Configurar la base de datos:

Usar migraciones de EF Core:

```bash
dotnet ef database update
```

Configurar conexiÃ³n a BD:
Editar appsettings.json:

```json
"ConnectionStrings": {
  "DefaultConnection": "Server=localhost;Database=db;User Id=sa;Password=TuContraseÃ±a;TrustServerCertificate=True;"
}
```

## ğŸ§ª Tests Unitarios

Se incluye una soluciÃ³n aparte llamada `API-Productos.Unit-Testing` con pruebas unitarias para asegurar la calidad y correcto funcionamiento de las capas principales del proyecto.

```bash
ProductApi.UnitTests/
â”œâ”€â”€ Services/
â”‚ â””â”€â”€ ProductServiceTests.cs # Pruebas de lÃ³gica de negocio
â”œâ”€â”€ Controllers/
â”‚ â””â”€â”€ ProductControllerTests.cs # Pruebas de comportamiento del controlador
â”œâ”€â”€ Validators/
â”‚ â””â”€â”€ ProductCreateDtoValidatorTests.cs
```

---

### ğŸ”§ Herramientas utilizadas

| Paquete            | PropÃ³sito                         |
| ------------------ | --------------------------------- |
| `xUnit`            | Framework de testing principal    |
| `Moq`              | SimulaciÃ³n (mock) de dependencias |
| `FluentAssertions` | Assertions mÃ¡s expresivas         |
| `FluentValidation` | ValidaciÃ³n de reglas en DTOs      |

---

### âœ… Cobertura actual

| Capa                | Cobertura                      | Detalles                                                           |
| ------------------- | ------------------------------ | ------------------------------------------------------------------ |
| `ProductService`    | âœ… 100%                        | Pruebas de creaciÃ³n, actualizaciÃ³n, eliminaciÃ³n y obtenciÃ³n por ID |
| `ProductController` | âœ… 100%                        | Pruebas de cada endpoint con validaciones y errores                |
| `FluentValidation`  | âœ… 100%                        | Reglas para `ProductCreateDTO` probadas                            |
| `PagedResponse<T>`  | âœ… Usado y probado en `GetAll` |

---

### ğŸ§ª Pruebas destacadas

#### âœ”ï¸ ProductServiceTests

- SimulaciÃ³n del repositorio (`IProductRepository`).
- Pruebas unitarias de los mÃ©todos: `CreateAsync`, `UpdateAsync`, `DeleteAsync`, `GetByIdAsync`.

#### âœ”ï¸ ProductControllerTests

- Mock de `IProductService` y `IValidator<ProductCreateDTO>`.
- Verifica:
  - Respuestas HTTP (`200`, `400`, `404`).
  - Errores de validaciÃ³n.
  - Respuesta estructurada con `ApiResponseData<T>` y `PagedResponse<T>`.

#### âœ”ï¸ Validaciones

- Se prueba cada regla definida con FluentValidation.
- Casos vÃ¡lidos e invÃ¡lidos, usando `TestValidate`.

---

### ğŸš€ Ejecutar los tests

UbÃ­cate en la carpeta raÃ­z del proyecto y ejecuta:

```bash
dotnet test ProductApi.UnitTests
```

---

# ğŸ§ª Tests de IntegraciÃ³n

El proyecto incluye una soluciÃ³n llamada ProductApi.IntegrationTests que contiene pruebas de integraciÃ³n tanto de capa de servicio (Service-Repository) como de controlador (API completa usando HttpClient). Estas pruebas aseguran el funcionamiento real de la aplicaciÃ³n, incluyendo:

- Acceso a base de datos (SQLite en memoria).
- LÃ³gica de negocio real (ProductService).
- Controladores HTTP reales (ProductController).
- Validaciones (FluentValidation).
- PaginaciÃ³n y filtros.

## ğŸ“ Estructura

```bash
ProductApi.IntegrationTests/
â”œâ”€â”€ CustomWebApplicationFactory.cs         # Inicializa entorno web para pruebas completas
â”œâ”€â”€ Helper/
â”œ   â”œ__TestHelper.cs                          # Crea DbContext con SQLite en memoria
â”œâ”€â”€ Services/
â”‚   â””â”€â”€ ProductServiceIntegrationTests.cs  # Pruebas integradas de servicios y repositorios
â”œâ”€â”€ Controllers/
â”‚   â””â”€â”€ ProductControllerIntegrationTests.cs  # Pruebas completas de endpoints

```

## ğŸ”§ Dependencias utilizadas

| Paquete                              | PropÃ³sito                        |
| ------------------------------------ | -------------------------------- |
| xUnit                                | Framework de testing principal   |
| FluentAssertions                     | Assertions legibles y expresivos |
| Microsoft.EntityFrameworkCore.Sqlite | Base de datos SQLite in-memory   |
| Microsoft.AspNetCore.Mvc.Testing     | Pruebas con servidor real (API)  |

## âœ… Pruebas implementadas

### ğŸ§ª Services (ProductServiceIntegrationTests.cs)

| Test                                  | DescripciÃ³n                                        |
| ------------------------------------- | -------------------------------------------------- |
| Create_Then_GetById                   | Inserta un producto y lo recupera por ID           |
| Update_Should_Modify_Existing_Product | Actualiza un producto existente y verifica cambios |
| Delete_Should_Remove_Product          | Elimina un producto y valida que no existe         |
| GetAll_Should_Filter_By_Name          | Filtro por nombre exacto                           |
| GetAll_Should_Filter_By_Description   | Filtro por descripciÃ³n                             |
| GetAll_Should_Filter_By_Price         | Filtro por precio exacto                           |
| GetAll_Should_Filter_By_Stock         | Filtro por stock exacto                            |
| GetAll_Should_Paginate_Results        | Valida que la paginaciÃ³n funcione correctamente    |

## ğŸš€ Ejecutar los tests
Ubicado en la raÃ­z del proyecto:
```bash
dotnet test ProductApi.IntegrationTests
```

## ğŸ”¥ Ejecutar la AplicaciÃ³n

Instalar dependencias:

```bash
dotnet restore
```

Ejecutar:

```bash
dotnet run
```
